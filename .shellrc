# Custom user Configuration for shell

# ---------- CUSTOM ENV VARIABLES ----------

export DOTFILES_HOME=$(dirname $0)

export REPO_HOME="$HOME/Repo"
export REPO_PERSONAL_HOME="$REPO_HOME/personal"
export REPO_THIRD_HOME="$REPO_HOME/thirdparty"


# ---------- INSTALL PROGRAMS ----------

ensure() {
	if ! command -V $1 &>/dev/null; then
		echo please install $1
	fi
}

ensure python3
ensure nala
ensure nnn
ensure fzf

unset ensure


# ---------- ALIASES ----------
alias ssh-user='ssh-add $HOME/.ssh/github'

alias ls="ls --color=auto"
alias l="ls -Algh --time-style=iso --color=auto --group-directories-first"
# For directing standard output to clipboard.
# use like 'echo "Hello" | clipboard' then use Ctrl+V somewhere.
alias clipboard="xclip -sel clip"

alias pn=pnpm
alias python="python3"
alias icat="kitty +kitten icat"
alias V="nvim"
alias nnn="nnn -H"

# Shutdown pc when there's a blackout
alias sefelalu="shutdown --poweroff now"


# ---------- CUSTOM FUNCTIONS ----------

PLESS_STYLE="monokai"

# pless <arg>
# Color text before passing args to less
pless() {
	pygmentize -O style="$PLESS_STYLE" $1 | less
}

# lnsoft {<source_path> ... }
# Create a softs links on current directory pointing to sources
lnsoft() {
	if [ $# -eq 0 ]; then
		echo "Usage: lnsoft {<source_path>, ... }"
		return 1
	fi

	for source_path in "$@"; do
		base_name=$(basename "$source_path")
		ln -s "$source_path" "./$base_name"
	done
}

repo(){
	GIT_USERNAME="4ngelf"
	DST=$($DOTFILES_HOME/tool/repo_owner.py $GIT_USERNAME $@)
	
	test $? -eq 0 || exit 1

	CURRENT=$(pwd)
	if [[ "$DST" == "personal" ]]; then
		[[ -d "$REPO_PERSONAL_HOME" ]] || mkdir -p "$REPO_PERSONAL_HOME"
		cd "$REPO_PERSONAL_HOME"
		git clone $@
	else
		[[ -d "$REPO_THIRD_HOME" ]] || mkdir -p "$REPO_THIRD_HOME"
		cd "$REPO_THIRD_HOME"
		git clone $@
	fi
	cd $CURRENT
}

open-repo(){
	# TODO	
}


# ---------- LOCAL CONFIG ----------

# If there's some local config load them
if [ -f ./local.shellrc ]; then
    source ./local.shellrc
fi

